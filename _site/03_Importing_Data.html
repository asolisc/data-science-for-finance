<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Science for Finance - 03_Importing_Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Data Science for Finance</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-course-info" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Course Info</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-course-info">    
        <li>
    <a class="dropdown-item" href="./lectures/00_Prework.html" rel="" target="">
 <span class="dropdown-text">Prework</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03_Importing_Data.html" rel="" target="">
 <span class="dropdown-text">Schedule</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03_Importing_Data.html" rel="" target="">
 <span class="dropdown-text">Meet the Team</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-lectures" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Lectures</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-lectures">    
        <li>
    <a class="dropdown-item" href="./03_Importing_Data.html" rel="" target="">
 <span class="dropdown-text">1. Introduction to the <code>tidyverse</code></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03_Importing_Data.html" rel="" target="">
 <span class="dropdown-text">2. Importing Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03_Importing_Data.html" rel="" target="">
 <span class="dropdown-text">3. Data Manipulation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03_Importing_Data.html" rel="" target="">
 <span class="dropdown-text">4. Data Visualization</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03_Importing_Data.html" rel="" target="">
 <span class="dropdown-text">5. Tidy Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03_Importing_Data.html" rel="" target="">
 <span class="dropdown-text">6. Creating Functions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03_Importing_Data.html" rel="" target="">
 <span class="dropdown-text">7. Iteration</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03_Importing_Data.html" rel="" target="">
 <span class="dropdown-text">8. Quarto</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03_Importing_Data.html" rel="" target="">
 <span class="dropdown-text">9. Wrap Up</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-downloads" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
      <i class="bi bi-download" role="img">
</i> 
 <span class="menu-text">Downloads</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-downloads">    
        <li>
    <a class="dropdown-item" href="./downloads/course_materials.zip" rel="" target="">
 <span class="dropdown-text">All Course Materials</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./downloads/course_materials.zip" rel="" target="">
 <span class="dropdown-text">Data Sets</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./downloads/course_materials.zip" rel="" target="">
 <span class="dropdown-text">Font Files</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">3.1 Introduction</a></li>
  <li><a href="#read-data-from-excel-files" id="toc-read-data-from-excel-files" class="nav-link" data-scroll-target="#read-data-from-excel-files">3.2 Read data from Excel Files:</a></li>
  <li><a href="#reading-data-from-a-csv-file" id="toc-reading-data-from-a-csv-file" class="nav-link" data-scroll-target="#reading-data-from-a-csv-file">3.3 Reading Data from a CSV file</a>
  <ul class="collapse">
  <li><a href="#some-clean-up" id="toc-some-clean-up" class="nav-link" data-scroll-target="#some-clean-up">3.3.1 Some Clean up</a></li>
  </ul></li>
  <li><a href="#reading-data-from-yahoo-finance" id="toc-reading-data-from-yahoo-finance" class="nav-link" data-scroll-target="#reading-data-from-yahoo-finance">3.4 Reading Data from Yahoo Finance</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">03_Importing_Data</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">3.1 Introduction</h2>
<p>This chapter will teach you the basics of bringing data files into R. Specifically, it will focus on reading plain-text rectangular files. You’ll get practical advice on handling things like column names, types, and missing data. You’ll also learn about reading data from multiple files and writing data from R to a file. Finally, you’ll learn how to create data frames in R. In this chapter, you’ll learn how to load flat files in R using the readr package, which is a part of the core tidyverse.</p>
<p>We’ll start loading libraries…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.0     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.1     ✔ tibble    3.1.8
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.1     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
</section>
<section id="read-data-from-excel-files" class="level2">
<h2 class="anchored" data-anchor-id="read-data-from-excel-files">3.2 Read data from Excel Files:</h2>
<p>To read Excel Files we’ll need to install the library “readxl”.</p>
<p>Let’s import daily prices of the S&amp;P500, NASDAQ, DJIA, and IPC:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">excel_sheets</span>(<span class="st">"data/xl/daily.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "S&amp;P500" "NASDAQ" "DJIA"   "IPC"   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>SP_daily <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/xl/daily.xlsx"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>NASDAQ_daily <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/xl/daily.xlsx"</span>,<span class="st">"NASDAQ"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>DJIA_daily <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/xl/daily.xlsx"</span>,<span class="dv">3</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#IPC_daily &lt;- read_excel("data/xl/daily.xlsx",4)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(SP_daily) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  date          volume   max   min close  open
  &lt;chr&gt;          &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 35189      604566402  757.  753.  656.  656.
2 10/18/1996         0  711.  706.  711.  707.
3 10/21/1996         0  714.  708.  710.  711.
4 10/22/1996         0  710.  705.  707.  710.
5 10/23/1996         0  707.  701.  707.  707.
6 10/24/1996         0  708.  702.  702.  707.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(SP_daily)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 6,041
Columns: 6
$ date   &lt;chr&gt; "35189", "10/18/1996", "10/21/1996", "10/22/1996", "10/23/1996"…
$ volume &lt;dbl&gt; 604566402, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ max    &lt;dbl&gt; 757.30, 711.04, 714.10, 709.78, 707.31, 708.25, 704.11, 705.40,…
$ min    &lt;dbl&gt; 753.18, 706.11, 707.71, 704.55, 700.98, 702.11, 700.53, 697.25,…
$ close  &lt;dbl&gt; 655.86, 710.82, 709.85, 706.57, 707.27, 702.29, 700.92, 697.26,…
$ open   &lt;dbl&gt; 655.86, 706.89, 710.82, 709.78, 706.57, 707.33, 702.31, 700.92,…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#head(IPC_daily)    </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="reading-data-from-a-csv-file" class="level2">
<h2 class="anchored" data-anchor-id="reading-data-from-a-csv-file">3.3 Reading Data from a CSV file</h2>
<p>Now we’ll focus on the most common rectangular data file type: CSV, which is short for comma-separated values. Here is what a simple CSV file looks like. The first row, commonly called the header row, gives the column names, and the following six rows provide the data. The columns are separated, aka delimited, by commas.</p>
<pre><code>Symbol, Name, Sector
1. A, Agilent Technologies Inc, Health Care
2. AAL, American Airlines Group, Industrials
3. AAP, Advance Auto Parts, Consumer Discretionary
4. AAPL, Apple Inc., Information Technology
5. ABBV, AbbVie Inc., Health Care</code></pre>
<p>We can read this file into R using <a href="https://readr.tidyverse.org/reference/read_delim.html"><code>read_csv()</code></a>. The first argument is the most important: the path to the file. You can think about the path as the address of the file: the file is called <code>students.csv</code> and that it lives in the <code>data</code> folder.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Tickers &lt;- read_csv("https://gist.github.com/ZeccaLehn/f6a2613b24c393821f81c0c1d23d4192")</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">#head(Tickers)</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>Tickers2 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"CSV_Lalo/SP500.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 505 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (3): Symbol, Name, Sector

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Tickers2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  Symbol Name                Sector                
  &lt;chr&gt;  &lt;chr&gt;               &lt;chr&gt;                 
1 MMM    3M Company          Industrials           
2 AOS    A.O. Smith Corp     Industrials           
3 ABT    Abbott Laboratories Health Care           
4 ABBV   AbbVie Inc.         Health Care           
5 ACN    Accenture plc       Information Technology
6 ATVI   Activision Blizzard Information Technology</code></pre>
</div>
</div>
<section id="some-clean-up" class="level3">
<h3 class="anchored" data-anchor-id="some-clean-up">3.3.1 Some Clean up</h3>
<ul>
<li>NAs</li>
</ul>
<p>In the <code>Symbol</code> column, there are a bunch of Symbols items, and then the character string <code>N/A</code>, which should have been a real <code>NA</code> that R will recognize as “not available”. This is something we can address using the <code>na</code> argument. By default, <a href="https://readr.tidyverse.org/reference/read_delim.html"><code>read_csv()</code></a> only recognizes empty strings (<code>""</code>) in this dataset as <code>NA</code>s, we want it to also recognize the character string <code>"N/A"</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Tickers2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  Symbol Name                Sector                
  &lt;chr&gt;  &lt;chr&gt;               &lt;chr&gt;                 
1 MMM    3M Company          Industrials           
2 AOS    A.O. Smith Corp     Industrials           
3 ABT    Abbott Laboratories Health Care           
4 ABBV   AbbVie Inc.         Health Care           
5 ACN    Accenture plc       Information Technology
6 ATVI   Activision Blizzard Information Technology</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>Tickers2 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"CSV_Lalo/SP500.csv"</span>, <span class="at">na =</span> <span class="fu">c</span>(<span class="st">"N/A"</span>, <span class="st">""</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 505 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (3): Symbol, Name, Sector

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Tickers2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  Symbol Name                Sector                
  &lt;chr&gt;  &lt;chr&gt;               &lt;chr&gt;                 
1 MMM    3M Company          Industrials           
2 AOS    A.O. Smith Corp     Industrials           
3 ABT    Abbott Laboratories Health Care           
4 ABBV   AbbVie Inc.         Health Care           
5 ACN    Accenture plc       Information Technology
6 ATVI   Activision Blizzard Information Technology</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(Tickers2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  Symbol Name                   Sector                
  &lt;chr&gt;  &lt;chr&gt;                  &lt;chr&gt;                 
1 XL     XL Capital             Financials            
2 XYL    Xylem Inc.             Industrials           
3 YUM    Yum! Brands Inc        Consumer Discretionary
4 ZBH    Zimmer Biomet Holdings Health Care           
5 ZION   Zions Bancorp          Financials            
6 ZTS    Zoetis                 Health Care           </code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>Tickers2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 505 × 3
   Symbol Name                       Sector                
   &lt;chr&gt;  &lt;chr&gt;                      &lt;chr&gt;                 
 1 MMM    3M Company                 Industrials           
 2 AOS    A.O. Smith Corp            Industrials           
 3 ABT    Abbott Laboratories        Health Care           
 4 ABBV   AbbVie Inc.                Health Care           
 5 ACN    Accenture plc              Information Technology
 6 ATVI   Activision Blizzard        Information Technology
 7 AYI    Acuity Brands Inc          Industrials           
 8 ADBE   Adobe Systems Inc          Information Technology
 9 AAP    Advance Auto Parts         Consumer Discretionary
10 AMD    Advanced Micro Devices Inc Information Technology
# … with 495 more rows</code></pre>
</div>
</div>
<ul>
<li>Names of Variables.</li>
</ul>
<p>You might also notice that the <code>Company Name</code>column is surrounded by backticks. That’s because they contain spaces, breaking R’s usual rules for variable names; they’re <strong>non-syntactic</strong> names. To refer to these variables, you need to surround them with backticks, <code>`</code>. Instead of space names should have _.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Tickers2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Symbol" "Name"   "Sector"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>Tickers2 <span class="ot">&lt;-</span> Tickers2 <span class="sc">|&gt;</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Company_Name =</span> <span class="st">`</span><span class="at">Name</span><span class="st">`</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Tickers2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Symbol"       "Company_Name" "Sector"      </code></pre>
</div>
</div>
<p>An alternative approach is to use <a href="https://sfirke.github.io/janitor/reference/clean_names.html"><code>janitor::clean_names()</code></a> to use some heuristics to turn them all into snake case at once<sup><a href="https://r4ds.hadley.nz/data-import#fn1">1</a></sup>. It’s always better to type the names of columns in small letters and with _ instead of space ” “.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>Tickers2 <span class="sc">|&gt;</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 505 × 3
   symbol company_name               sector                
   &lt;chr&gt;  &lt;chr&gt;                      &lt;chr&gt;                 
 1 MMM    3M Company                 Industrials           
 2 AOS    A.O. Smith Corp            Industrials           
 3 ABT    Abbott Laboratories        Health Care           
 4 ABBV   AbbVie Inc.                Health Care           
 5 ACN    Accenture plc              Information Technology
 6 ATVI   Activision Blizzard        Information Technology
 7 AYI    Acuity Brands Inc          Industrials           
 8 ADBE   Adobe Systems Inc          Information Technology
 9 AAP    Advance Auto Parts         Consumer Discretionary
10 AMD    Advanced Micro Devices Inc Information Technology
# … with 495 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Cmd+Shift+M</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>Variable Types</p>
<p>Another common task after reading in data is to consider variable types. For example, <code>sector</code> is a categorical variable with a known set of possible values, which in R should be represented as a factor:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>Tickers2 <span class="sc">|&gt;</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sector =</span> <span class="fu">factor</span>(sector))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 505 × 3
   symbol company_name               sector                
   &lt;chr&gt;  &lt;chr&gt;                      &lt;fct&gt;                 
 1 MMM    3M Company                 Industrials           
 2 AOS    A.O. Smith Corp            Industrials           
 3 ABT    Abbott Laboratories        Health Care           
 4 ABBV   AbbVie Inc.                Health Care           
 5 ACN    Accenture plc              Information Technology
 6 ATVI   Activision Blizzard        Information Technology
 7 AYI    Acuity Brands Inc          Industrials           
 8 ADBE   Adobe Systems Inc          Information Technology
 9 AAP    Advance Auto Parts         Consumer Discretionary
10 AMD    Advanced Micro Devices Inc Information Technology
# … with 495 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="reading-data-from-yahoo-finance" class="level2">
<h2 class="anchored" data-anchor-id="reading-data-from-yahoo-finance">3.4 Reading Data from Yahoo Finance</h2>
<p>You can use the <strong><code>quantmod</code></strong> package in R to retrieve stock market data from Yahoo Finance. Make sure you have the package installed. You can install it using <strong><code>install.packages("quantmod")</code></strong> if you haven’t already. Here’s an example of how to retrieve daily prices for the S&amp;P 500 index from Yahoo Finance:</p>
<p>This script fetches the daily prices of the S&amp;P 500 index from Yahoo Finance starting from the specified start date up to the current date. You can customize the <strong><code>start_date</code></strong> and <strong><code>end_date</code></strong> variables to specify the time range for which you want to retrieve the data. The <strong><code>head(GSPC)</code></strong> function is used to display the first few rows of the retrieved data.</p>
<p>We can also use a more updated library for this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(yfR)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate) <span class="co"># for date manipulations</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># for data manipulations</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># set options for algorithm</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>my_ticker <span class="ot">&lt;-</span> <span class="st">'^GSPC'</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>first_date <span class="ot">&lt;-</span> <span class="st">"1950-01-01"</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>last_date <span class="ot">&lt;-</span> <span class="fu">Sys.Date</span>()</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co"># fetch data</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>df_yf <span class="ot">&lt;-</span> <span class="fu">yf_get</span>(<span class="at">tickers =</span> my_ticker, </span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">first_date =</span> first_date,</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">last_date =</span> last_date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Running yfR for 1 stocks | 1950-01-01 --&gt; 2024-03-21 (27108 days) ──</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Downloading data for benchmark ticker ^GSPC</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ (1/1) Fetching data for ^GSPC</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔   - found cache file (1950-01-03 --&gt; 2024-03-20)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔   - got 18674 valid rows (1950-01-03 --&gt; 2024-03-20)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔   - got 100% of valid prices -- Got it!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Binding price data</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Diagnostics ─────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Returned dataframe with 18674 rows -- All OK!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Using 1.9 MB at C:\Users\alexi\AppData\Local\Temp\RtmpG2R2Jv/yf_cache for 1 cache files</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Out of 1 requested tickers, you got 1 (100%)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># output is a tibble with data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>3.4.1 Practical Advice</p>
<p>Once you read data in, the first step usually involves transforming it in some way to make it easier to work with in the rest of your analysis. Let’s take another look at the <code>Prices of ^GSPC</code>with that in mind.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_yf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 11
  ticker ref_date   price_open price_h…¹ price…² price…³ volume price…⁴ ret_ad…⁵
  &lt;chr&gt;  &lt;date&gt;          &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
1 ^GSPC  1950-01-03       16.7      16.7    16.7    16.7 1.26e6    16.7 NA      
2 ^GSPC  1950-01-04       16.8      16.8    16.8    16.8 1.89e6    16.8  0.0114 
3 ^GSPC  1950-01-05       16.9      16.9    16.9    16.9 2.55e6    16.9  0.00475
4 ^GSPC  1950-01-06       17.0      17.0    17.0    17.0 2.01e6    17.0  0.00295
5 ^GSPC  1950-01-09       17.1      17.1    17.1    17.1 2.52e6    17.1  0.00589
6 ^GSPC  1950-01-10       17.0      17.0    17.0    17.0 2.16e6    17.0 -0.00293
# … with 2 more variables: ret_closing_prices &lt;dbl&gt;,
#   cumret_adjusted_prices &lt;dbl&gt;, and abbreviated variable names ¹​price_high,
#   ²​price_low, ³​price_close, ⁴​price_adjusted, ⁵​ret_adjusted_prices</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df_yf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 18,674
Columns: 11
$ ticker                 &lt;chr&gt; "^GSPC", "^GSPC", "^GSPC", "^GSPC", "^GSPC", "^…
$ ref_date               &lt;date&gt; 1950-01-03, 1950-01-04, 1950-01-05, 1950-01-06…
$ price_open             &lt;dbl&gt; 16.66, 16.85, 16.93, 16.98, 17.08, 17.03, 17.09…
$ price_high             &lt;dbl&gt; 16.66, 16.85, 16.93, 16.98, 17.08, 17.03, 17.09…
$ price_low              &lt;dbl&gt; 16.66, 16.85, 16.93, 16.98, 17.08, 17.03, 17.09…
$ price_close            &lt;dbl&gt; 16.66, 16.85, 16.93, 16.98, 17.08, 17.03, 17.09…
$ volume                 &lt;dbl&gt; 1260000, 1890000, 2550000, 2010000, 2520000, 21…
$ price_adjusted         &lt;dbl&gt; 16.66, 16.85, 16.93, 16.98, 17.08, 17.03, 17.09…
$ ret_adjusted_prices    &lt;dbl&gt; NA, 0.0114045618, 0.0047477745, 0.0029533373, 0…
$ ret_closing_prices     &lt;dbl&gt; NA, 0.0114045618, 0.0047477745, 0.0029533373, 0…
$ cumret_adjusted_prices &lt;dbl&gt; 1.000000, 1.011405, 1.016206, 1.019208, 1.02521…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>df_yf <span class="sc">|&gt;</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18,674 × 11
   ticker ref_date   price_open price_…¹ price…² price…³ volume price…⁴ ret_ad…⁵
 * &lt;chr&gt;  &lt;date&gt;          &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
 1 ^GSPC  1950-01-03       16.7     16.7    16.7    16.7 1.26e6    16.7 NA      
 2 ^GSPC  1950-01-04       16.8     16.8    16.8    16.8 1.89e6    16.8  0.0114 
 3 ^GSPC  1950-01-05       16.9     16.9    16.9    16.9 2.55e6    16.9  0.00475
 4 ^GSPC  1950-01-06       17.0     17.0    17.0    17.0 2.01e6    17.0  0.00295
 5 ^GSPC  1950-01-09       17.1     17.1    17.1    17.1 2.52e6    17.1  0.00589
 6 ^GSPC  1950-01-10       17.0     17.0    17.0    17.0 2.16e6    17.0 -0.00293
 7 ^GSPC  1950-01-11       17.1     17.1    17.1    17.1 2.63e6    17.1  0.00352
 8 ^GSPC  1950-01-12       16.8     16.8    16.8    16.8 2.97e6    16.8 -0.0193 
 9 ^GSPC  1950-01-13       16.7     16.7    16.7    16.7 3.33e6    16.7 -0.00537
10 ^GSPC  1950-01-16       16.7     16.7    16.7    16.7 1.46e6    16.7  0.00300
# … with 18,664 more rows, 2 more variables: ret_closing_prices &lt;dbl&gt;,
#   cumret_adjusted_prices &lt;dbl&gt;, and abbreviated variable names ¹​price_high,
#   ²​price_low, ³​price_close, ⁴​price_adjusted, ⁵​ret_adjusted_prices</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>